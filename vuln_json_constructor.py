import json
from vulnerability import Vulnerability

vuln_table = []

previous_file_bool = False

# read in the json file immediately on execution of program
try:
    with open("vulnerabilities.json", "r") as f:
        vuln_table = json.loads(f.read())
        previous_file_bool = True
except:
    previous_file_bool = False

# get a loop going to receive options
while True:
    user_in = input("Input options:\nq - to quit\nn - add new vulnerability\ng - generate json file\nr - remove vulnerability\np - print vulnerability table\nf - read from file\n")

    match user_in:
        case 'q':
            quit()
        case 'n':
            print("add new vulnerability")
            confirm_bool = False

            while confirm_bool is False:
                try:
                    name_in = input("name: ")
                    description_in = input("description: ")
                    resources_in = [x.lstrip() for x in input("resources (separated by comma): ").split(',')]
                    categories_in = [x.lstrip() for x in input("categories (separated by comma; e.g. \"SQL, Web, Database\"): ").split(',')]

                    print(name_in)
                    print(description_in)
                    print(resources_in)
                    print(categories_in)

                    confirm_in = input("confirm (y/n)? ")

                    if confirm_in == 'y' or confirm_in == 'Y':
                        confirm_bool = True
                except:
                    print("something wrong with format")
            
            vuln = Vulnerability(name_in, description_in, resources_in, categories_in)
            print(repr(vuln))

            vuln_table.append(json.loads(repr(vuln)))
        case 'g':
            print("generate json file")
            with open("vulnerabilities.json", "w+") as f:
                write_file_bool = True

                if previous_file_bool:
                    confirm_in = input("Overwrite previous file (y/n)? ")

                    if confirm_in == 'n' or confirm_in == 'N':
                        write_file_bool = False

                if write_file_bool:
                    f.write(json.dumps(vuln_table, indent=4))
        case 'r':
            print("remove vulnerability")
            index_in = input("which index to remove? ")
            
            vuln_table.pop(int(index_in))
        case 'p':
            print(repr(vuln_table))
        case 'f':
            with open("vulnerabilities.json", "r") as f:
                vuln_table = json.loads(f.read())

# have an array to keep track of all the vulnerabilities added

# one of the option should be adding vulnerabilities

# one of the option should be quitting
