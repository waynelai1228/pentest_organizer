import sqlite3
import uuid
from vulnerability import Vulnerability
from test_plan_item import Progress
from test_plan_item import TestPlanItem

class PentestOrganizer:
    def __init__(self):
        print("init")
        # connect to database
        self.con = sqlite3.connect("application.db")
        self.cur = self.con.cursor()

    def create_new_test_plan(self, name: str):
        print("create new test plan")

        data = (str(uuid.uuid4()), name)
        add_test_plan_statement = "INSERT INTO test_plan VALUES(?, ?)"
        res = self.cur.execute(add_test_plan_statement, data)
        print(res.fetchall())
        self.con.commit()

    def add_new_vulnerability(self, name: str, description: str, resources, categories):
        print("add new vulnerability")

        # TODO: add necessary access control

        data = (str(uuid.uuid4()), name, description, resources, categories)
        add_vuln_statement = "INSERT INTO vulnerabilities VALUES(?, ?, ?, ?, ?)"
        res = self.cur.execute(add_vuln_statement, data)
        print(res.fetchall())
        self.con.commit()

    def add_test_plan_item(self, vulnerability_uuid: str, progress: Progress, test_plan_uuid: str):
        print("add test plan item")

        # TODO: add necessary access control

        data = (str(uuid.uuid4()), vulnerability_uuid, str(progress), test_plan_uuid)
        add_item_statement = "INSERT INTO test_plan_item VALUES(?, ?, ?, ?)"
        res = self.cur.execute(add_item_statement, data)
        print(res.fetchall())
        self.con.commit()

if __name__ == "__main__":
    po = PentestOrganizer()
    po.create_new_test_plan("lol")
